<div class="all-products">
  <h1 *ngIf="mode === 'all'">All Products</h1>
  <h1 *ngIf="mode === 'my'">My Products</h1>

  <div class="controls">
    <!-- Search -->
    <input
      type="text"
      class="search-input"
      placeholder="Search products..."
      [(ngModel)]="searchTerm"
      (input)="onSearchTermChange()"
    />

    <!-- Filter by category -->
    <select class="filter-select" [(ngModel)]="filterCategory" (change)="onFilterChange()">
      <option value="all">All Categories</option>
      <option *ngFor="let category of categories" [value]="category.id">
        {{ category.name }}
      </option>
    </select>

    <!-- Filter by availability -->
    <select class="filter-select" [(ngModel)]="filterAvailability" (change)="onFilterChange()">
      <option value="all">All</option>
      <option value="true">Available</option>
      <option value="false">Unavailable</option>
    </select>

    <!-- Filter by event type -->
    <select class="filter-select" [(ngModel)]="filterEventType" (change)="onFilterChange()">
      <option value="all">All Event Types</option>
      <option *ngFor="let type of eventTypes" [value]="type.id">
        {{ type.name }}
      </option>
    </select>

    <!-- Price range -->
    <input
      type="number"
      class="price-input"
      placeholder="Min price"
      [(ngModel)]="filterMinPrice"
      (input)="onFilterChange()"
    />
    <input
      type="number"
      class="price-input"
      placeholder="Max price"
      [(ngModel)]="filterMaxPrice"
      (input)="onFilterChange()"
    />

    <!-- Button to add new product -->
    <div *ngIf="userRole === 'SPProvider'" class="add-product-btn">
      <button [routerLink]="['/products/create']">Add Product</button>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="isLoading" class="loader">Loading products...</div>

  <!-- Products grid -->
  <div class="product-grid" *ngIf="!isLoading && filteredProducts.length > 0">
    <div class="product-card" *ngFor="let product of filteredProducts">
      <button
        *ngIf="mode == 'my'"
        class="delete-btn"
        (click)="deleteProduct(product.id)">âœ•</button>

      <img [src]="product.imageURLs?.[0] 
                    ? 'http://localhost:8080/api' + product.imageURLs[0] 
                    : '../assets/images/default_product.png'" alt="{{ product.name }} Image" />
      <h3>{{ product.name }}</h3>
      <p>{{ product.description }}</p>
      <p><strong>Price:</strong> {{ product.price }} RSD</p>
      <button class="details-btn" [routerLink]="['/product', product.id]">View Details</button>
      <button
        *ngIf="mode === 'my'"
        class="edit-btn"
        [routerLink]="['/products/edit', product.id]">
        Edit Product
      </button>
    </div>
  </div>

  <!-- Empty message -->
  <div *ngIf="!isLoading && filteredProducts.length === 0" class="no-products">
    No products available.
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!isLoading && totalPages > 1">
    <button class="pagination-btn" [disabled]="currentPage === 0" (click)="goToPage(currentPage - 1)">
      Previous
    </button>

    <span *ngFor="let page of [].constructor(totalPages); let i = index">
      <button class="pagination-btn" [class.active]="i === currentPage" (click)="goToPage(i)">
        {{ i + 1 }}
      </button>
    </span>

    <button class="pagination-btn" [disabled]="currentPage === totalPages - 1" (click)="goToPage(currentPage + 1)">
      Next
    </button>
  </div>
</div>
